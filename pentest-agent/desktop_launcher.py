from __future__ import annotations

import os
import subprocess
import sys
import time
import webbrowser
from pathlib import Path


def main() -> None:
    root = Path(getattr(sys, "_MEIPASS", Path(__file__).resolve().parent))
    env = os.environ.copy()
    env["PYTHONPATH"] = str(root)
    backend = subprocess.Popen([sys.executable, "-m", "uvicorn", "backend.app:app", "--host", "127.0.0.1", "--port", "8000"], cwd=root, env=env)
    time.sleep(2)
    dashboard = subprocess.Popen([sys.executable, "-m", "streamlit", "run", "dashboard/app.py", "--server.port", "8501"], cwd=root, env=env)
    webbrowser.open("http://127.0.0.1:8501")
    try:
        dashboard.wait()
    finally:
        backend.terminate()


if __name__ == "__main__":
    main()
